<div>
    <h1>Admin Dashboard</h1>
    <div>
        <!-- Search Bar -->
    <div>
        <div>
            <form action="{{ url_for('admin_dashboard') }}" method="get">
                <input type="search" placeholder="Search users, subjects, chapters, quizzes, questions" 
                       aria-label="Search" name="search" value="{{ search_query or '' }}">
                <button type="submit">Search</button>
                {% if search_query %}
                    <a href="{{ url_for('admin_dashboard') }}">Clear</a>
                {% endif %}
            </form>
        </div>
    </div>
        <!-- Subjects Management -->
        <div>
            <h2>Subjects Management</h2>
            <div>
                <button onclick="location.href='/create_subject'">Create Subject</button>
                <button onclick="location.href='/edit_subject'">Edit Subject</button>
                <button onclick="location.href='/delete_subject'">Delete Subject</button>
            </div>
             <!-- Subjects Table -->
             <div>
                <div>
                    <h4>Subjects List {% if search_query %}(Search Results){% endif %}</h4>
                </div>
                <div>
                    {% if subjects %}
                    <div>
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Description</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for subject in subjects %}
                                <tr>
                                    <td>{{ subject.id }}</td>
                                    <td>{{ subject.name }}</td>
                                    <td>{{ subject.description|truncate(50) }}</td>
                                    <td>
                                        <a href="{{ url_for('edit_subject', id=subject.id) }}">Edit</a>
                                        <a href="{{ url_for('delete_subject', id=subject.id) }}" onclick="return confirm('Are you sure you want to delete this subject?')">Delete</a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <p>{% if search_query %}No subjects found matching "{{ search_query }}".{% else %}No subjects found. Create one to get started.{% endif %}</p>
                    {% endif %}
                </div>
            </div>
        </div>
        <hr></hr>
        
        <!-- Chapters Management -->
        <div>
            <h2>Chapters Management</h2>
            <div>
                <button onclick="location.href='/create_chapter'">Create Chapter</button>
                <button onclick="location.href='/edit_chapter'">Edit Chapter</button>
                <button onclick="location.href='/delete_chapter'">Delete Chapter</button>
            </div>
            
            <!-- Chapters Table -->
            <div>
                <div>
                    <h4>Chapters List {% if search_query %}(Search Results){% endif %}</h4>
                </div>
                <div>
                    {% if chapters %}
                    <div>
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Subject</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for chapter in chapters %}
                                <tr>
                                    <td>{{ chapter.id }}</td>
                                    <td>{{ chapter.name }}</td>
                                    <td>{{ chapter.subject.name }}</td>
                                    <td>
                                        <a href="{{ url_for('edit_chapter', id=chapter.id) }}">Edit</a>
                                        <a href="{{ url_for('delete_chapter', id=chapter.id) }}" onclick="return confirm('Are you sure you want to delete this chapter?')">Delete</a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <p>{% if search_query %}No chapters found matching "{{ search_query }}".{% else %}No chapters found. Create one to get started.{% endif %}</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    <div>
        <hr></hr>
        <!-- Quizzes Management -->
    <div>
        <div>
            <h2>Quizzes Management</h2>
            <div>
                <button onclick="location.href='/create_quiz'">Create Quiz</button>
                <button onclick="location.href='/edit_quiz'">Edit Quiz</button>
                <button onclick="location.href='/delete_quiz'">Delete Quiz</button>
            </div>
            
           <!-- Quizzes Table -->
           <div>
            <div>
                <h4>Quizzes List {% if search_query %}(Search Results){% endif %}</h4>
            </div>
            <div>
                {% if quizzes %}
                <div>
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Chapter</th>
                                <th>Date</th>
                                <th>Duration</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for quiz in quizzes %}
                            <tr>
                                <td>{{ quiz.id }}</td>
                                <td>{{ quiz.chapter.name }}</td>
                                <td>{{ quiz.date_of_quiz }}</td>
                                <td>{{ quiz.time_duration }}</td>
                                <td>
                                    <a href="{{ url_for('edit_quiz', id=quiz.id) }}">Edit</a>
                                    <a href="{{ url_for('delete_quiz', id=quiz.id) }}" onclick="return confirm('Are you sure you want to delete this quiz?')">Delete</a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p>{% if search_query %}No quizzes found matching "{{ search_query }}".{% else %}No quizzes found. Create one to get started.{% endif %}</p>
                {% endif %}
            </div>
        </div>
    </div>
    <hr></hr>
        <!-- Users Management -->
        <div>
            <h2>Users Management</h2>
            
             <!-- Users Table -->
             <div>
                <div>
                    <h4>Users List {% if search_query %}(Search Results){% endif %}</h4>
                </div>
                <div>
                    {% if users %}
                    <div>
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Username</th>
                                    <th>Email</th>
                                    <th>Qualification</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for user in users %}
                                <tr>
                                    <td>{{ user.id }}</td>
                                    <td>{{ user.username }}</td>
                                    <td>{{ user.email }}</td>
                                    <td>{{ user.qualification }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <p>{% if search_query %}No users found matching "{{ search_query }}".{% else %}No users found.{% endif %}</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    </div>
    <hr></hr>

    <!-- Questions Management -->
    <div>
        <div>
            <h2>Questions Management</h2>
            
            <!-- Questions Table -->
            <div>
                <div>
                    <h4>Questions List {% if search_query %}(Search Results){% endif %}</h4>
                </div>
                <div>
                    {% if questions %}
                    <div>
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Quiz</th>
                                    <th>Question Statement</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for question in questions %}
                                <tr>
                                    <td>{{ question.id }}</td>
                                    <td>{{ question.quiz.chapter.name }}</td>
                                    <td>{{ question.question_statement|truncate(100) }}</td>
                                    <td>
                                        <a href="{{ url_for('edit_question', id=question.id) }}">Edit</a>
                                        <a href="{{ url_for('delete_question', id=question.id) }}" onclick="return confirm('Are you sure you want to delete this question?')">Delete</a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <p>{% if search_query %}No questions found matching "{{ search_query }}".{% else %}No questions found.{% endif %}</p>
                    {% endif %}
                </div>
            </div>
    <div>
        <hr></hr>
        <!-- Summary Charts -->
        <div>
            <h2>Summary Charts</h2>
            <div>
                <div>
                    <div id="summary-charts">
                        <div>
                            <div>
                                <div>
                                    <div>
                                        <h5>Total Subjects</h5>
                                        <h2>{{ subjects|length }}</h2>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <div>
                                    <div>
                                        <h5>Total Chapters</h5>
                                        <h2>{{ chapters|length }}</h2>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <div>
                                    <div>
                                        <h5>Total Quizzes</h5>
                                        <h2>{{ quizzes|length if quizzes else 0 }}</h2>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <div>
                                    <div>
                                        <h5>Total Users</h5>
                                        <h2>{{ users|length if users else 0 }}</h2>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Subject-wise Scores -->
    <div>
        <div>
            <h2>Subject-wise Scores</h2>
            <div>
                <div>
                    {% if subject_scores %}
                    <div>
                        <table>
                            <thead>
                                <tr>
                                    <th>Subject</th>
                                    <th>Average Score</th>
                                    <th>Total Score</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for score in subject_scores %}
                                <tr>
                                    <td>{{ score.subject_name }}</td>
                                    <td>{{ score.avg_score }}</td>
                                    <td>{{ score.total_score }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <p>No scores found.</p>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <!-- Subject-wise Attempts -->
        <div>
            <h2>Subject-wise Attempts</h2>
            <div>
                <div>
                    {% if subject_attempts %}
                    <div>
                        <table>
                            <thead>
                                <tr>
                                    <th>Subject</th>
                                    <th>Total Attempts</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for attempt in subject_attempts %}
                                <tr>
                                    <td>{{ attempt.subject_name }}</td>
                                    <td>{{ attempt.attempts }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <p>No attempts found.</p>
                    {% endif %}
                    <a href="{{ url_for('logout') }}">Logout</a>
                </div>
            </div>
        </div>
    </div>
</div>